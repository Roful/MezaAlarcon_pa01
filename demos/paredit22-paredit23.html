<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=utf-8">
<LINK href="diff.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="nav.js"></script>
</head>
<body>
<div id="left" class="src">
<pre>
<a id='leftstart' tid='rightstart'></a>
<a id='6751' tid='6752' class='u'>;;; paredit.el --- minor mode for editing parentheses  -*- Mode: Emacs-Lisp -*-
</a>
<span class='d'>;; Copyright (C) 2005--2010 Taylor R. Campbell
</span>
<a id='6753' tid='6754' class='u'>;; Author: Taylor R. Campbell
</a><span class='d'>;; Version: 22
</span><a id='6755' tid='6756' class='u'>;; Created: 2005-07-31
</a><a id='6757' tid='6758' class='u'>;; Keywords: lisp
</a>
<a id='6759' tid='6760' class='u'>;; Paredit is free software: you can redistribute it and/or modify it
</a><a id='6761' tid='6762' class='u'>;; under the terms of the GNU General Public License as published by
</a><a id='6763' tid='6764' class='u'>;; the Free Software Foundation, either version 3 of the License, or
</a><a id='6765' tid='6766' class='u'>;; (at your option) any later version.
</a><a id='6767' tid='6768' class='u'>;;
</a><a id='6769' tid='6770' class='u'>;; Paredit is distributed in the hope that it will be useful, but
</a><a id='6771' tid='6772' class='u'>;; WITHOUT ANY WARRANTY; without even the implied warranty of
</a><a id='6773' tid='6774' class='u'>;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
</a><a id='6775' tid='6776' class='u'>;; GNU General Public License for more details.
</a><a id='6777' tid='6778' class='u'>;;
</a><a id='6779' tid='6780' class='u'>;; You should have received a copy of the GNU General Public License
</a><a id='6781' tid='6782' class='u'>;; along with paredit.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
</a>
<a id='6783' tid='6784' class='u'>;;; This file is permanently stored at
</a><span class='d'>;;;   &lt;http://mumble.net/~campbell/emacs/paredit-22.el&gt;.
</span><a id='6785' tid='6786' class='u'>;;;
</a><a id='6787' tid='6788' class='u'>;;; The currently released version of paredit is available at
</a><a id='6789' tid='6790' class='u'>;;;   &lt;http://mumble.net/~campbell/emacs/paredit.el&gt;.
</a><a id='6791' tid='6792' class='u'>;;;
</a><a id='6793' tid='6794' class='u'>;;; The latest beta version of paredit is available at
</a><a id='6795' tid='6796' class='u'>;;;   &lt;http://mumble.net/~campbell/emacs/paredit-beta.el&gt;.
</a><a id='6797' tid='6798' class='u'>;;;
</a><a id='6799' tid='6800' class='u'>;;; Release notes are available at
</a><a id='6801' tid='6802' class='u'>;;;   &lt;http://mumble.net/~campbell/emacs/paredit.release&gt;.
</a>
<a id='6803' tid='6804' class='u'>;;; Install paredit by placing `paredit.el&#39; in `/path/to/elisp&#39;, a
</a><a id='6805' tid='6806' class='u'>;;; directory of your choice, and adding to your .emacs file:
</a><a id='6807' tid='6808' class='u'>;;;
</a><a id='6809' tid='6810' class='u'>;;;   (add-to-list &#39;load-path &quot;/path/to/elisp&quot;)
</a><a id='6811' tid='6812' class='u'>;;;   (autoload &#39;enable-paredit-mode &quot;paredit&quot;
</a><a id='6813' tid='6814' class='u'>;;;     &quot;Turn on pseudo-structural editing of Lisp code.&quot;
</a><a id='6815' tid='6816' class='u'>;;;     t)
</a><a id='6817' tid='6818' class='u'>;;;
</a><span class='d'>;;; Enable Paredit Mode on the fly with `M-x enable-paredit-mode RET&#39;,
</span><span class='d'>;;; or always enable it in a major mode `M&#39; (e.g., `lisp&#39;) with:
</span><a id='6819' tid='6820' class='u'>;;;
</a><a id='6821' tid='6822' class='u'>;;;   (add-hook M-mode-hook &#39;enable-paredit-mode)
</a><a id='6823' tid='6824' class='u'>;;;
</a><a id='6825' tid='6826' class='u'>;;; Customize paredit using `eval-after-load&#39;:
</a><a id='6827' tid='6828' class='u'>;;;
</a><a id='6829' tid='6830' class='u'>;;;   (eval-after-load &#39;paredit
</a><span class='d'>;;;     &#39;(progn ...redefine keys, &c....))
</span><span class='d'>;;;
</span><span class='d'>;;; Paredit should run in GNU Emacs 21 or later and XEmacs 21.5 or
</span><span class='d'>;;; later.  Paredit is highly unlikely to work in earlier versions of
</span><span class='d'>;;; GNU Emacs, and it may have obscure problems in earlier versions of
</span><span class='d'>;;; XEmacs due to the way its syntax parser reports conditions, as a
</span><span class='d'>;;; result of which the code that uses the syntax parser must mask all
</span><span class='d'>;;; error conditions, not just those generated by the syntax parser.
</span><span class='d'>;;;
</span><span class='d'>;;; Questions, bug reports, comments, feature suggestions, &c., may be
</span><span class='d'>;;; addressed via email to the author&#39;s surname at mumble.net or via
</span><span class='d'>;;; IRC to the user named Riastradh on irc.freenode.net in the #paredit
</span><span class='d'>;;; channel.
</span><span class='d'>;;;
</span><span class='d'>;;; Please contact the author rather than forking your own versions, to
</span><span class='d'>;;; prevent the dissemination of random variants floating about the
</span><span class='d'>;;; internet unbeknownst to the author.  Laziness is not an excuse:
</span><span class='d'>;;; your laziness costs me confusion and time trying to support
</span><span class='d'>;;; paredit, so if you fork paredit, you make the world a worse place.
</span><span class='d'>;;;
</span><span class='d'>;;; *** WARNING *** IMPORTANT *** DO NOT SUBMIT BUGS BEFORE READING ***
</span><span class='d'>;;;
</span><span class='d'>;;; If you plan to submit a bug report, where some sequence of keys in
</span><span class='d'>;;; Paredit Mode, or some sequence of paredit commands, doesn&#39;t do what
</span><span class='d'>;;; you wanted, then it is helpful to isolate an example in a very
</span><span class='d'>;;; small buffer, and it is **ABSOLUTELY**ESSENTIAL** that you supply,
</span><span class='d'>;;; along with the sequence of keys or commands,
</span><span class='d'>;;;
</span><span class='d'>;;;   (1) the version of Emacs,
</span><span class='d'>;;;   (2) the version of paredit.el[*], and
</span><span class='d'>;;;   (3) the **COMPLETE** state of the buffer used to reproduce the
</span><span class='d'>;;;       problem, including major mode, minor modes, local key
</span><span class='d'>;;;       bindings, entire contents of the buffer, leading line breaks
</span><span class='d'>;;;       or spaces, &c.
</span><span class='d'>;;;
</span><span class='d'>;;; It is often extremely difficult to reproduce problems, especially
</span><span class='d'>;;; with commands such as `paredit-kill&#39;.  If you do not supply **ALL**
</span><span class='d'>;;; of this information, then it is highly probable that I cannot
</span><span class='d'>;;; reproduce your problem no matter how hard I try, and the effect of
</span><span class='d'>;;; submitting a bug without this information is only to waste your
</span><span class='d'>;;; time and mine.  So, please, include all of the above information.
</span><a id='6831' tid='6832' class='u'>;;;
</a><span class='d'>;;; [*] If you are using a beta version of paredit, be sure that you
</span><span class='d'>;;;     are using the *latest* edition of the beta version, available
</span><span class='d'>;;;     at &lt;http://mumble.net/~campbell/emacs/paredit-beta.el&gt;.  If you
</span><span class='d'>;;;     are not using a beta version, then upgrade either to that or to
</span><span class='d'>;;;     the latest release version; I cannot support older versions,
</span><span class='d'>;;;     and I can&#39;t fathom any reason why you might be using them.  So
</span><span class='d'>;;;     the answer to item (2) should be either `release&#39; or `beta&#39;.
</span>
<span class='d'>;;; The paredit minor mode, Paredit Mode, binds a number of simple
</span><span class='d'>;;; keys, notably `(&#39;, `)&#39;, `&quot;&#39;, and `\&#39;, to commands that more
</span><span class='d'>;;; carefully insert S-expression structures in the buffer.  The
</span><span class='d'>;;; parenthesis delimiter keys (round or square) are defined to insert
</span><span class='d'>;;; parenthesis pairs and move past the closing delimiter,
</span><span class='d'>;;; respectively; the double-quote key is multiplexed to do both, and
</span><span class='d'>;;; also to insert an escape if within a string; and backslashes prompt
</span><span class='d'>;;; the user for the next character to input, because a lone backslash
</span><span class='d'>;;; can break structure inadvertently.  These all have their ordinary
</span><span class='d'>;;; behaviour when inside comments, and, outside comments, if truly
</span><span class='d'>;;; necessary, you can insert them literally with `C-q&#39;.
</span><span class='d'>;;;
</span><span class='d'>;;; The key bindings are designed so that when typing new code in
</span><span class='d'>;;; Paredit Mode, you can generally use exactly the same keystrokes as
</span><span class='d'>;;; you would have used without Paredit Mode.  Earlier versions of
</span><span class='d'>;;; paredit.el did not conform to this, because Paredit Mode bound `)&#39;
</span><span class='d'>;;; to a command that would insert a newline.  Now `)&#39; is bound to a
</span><span class='d'>;;; command that does not insert a newline, and `M-)&#39; is bound to the
</span><span class='d'>;;; command that inserts a newline.  To revert to the former behaviour,
</span><span class='d'>;;; add the following forms to an `eval-after-load&#39; form for paredit.el
</span><span class='d'>;;; in your .emacs file:
</span><span class='d'>;;;
</span><span class='d'>;;;   (define-key paredit-mode-map (kbd &quot;)&quot;)
</span><span class='d'>;;;     &#39;paredit-close-round-and-newline)
</span><span class='d'>;;;   (define-key paredit-mode-map (kbd &quot;M-)&quot;)
</span><span class='d'>;;;     &#39;paredit-close-round)
</span><span class='d'>;;;
</span><span class='d'>;;; Paredit Mode also binds the usual keys for deleting and killing, so
</span><span class='d'>;;; that they will not destroy any S-expression structure by killing or
</span><span class='d'>;;; deleting only one side of a parenthesis or quote pair.  If the
</span><span class='d'>;;; point is on a closing delimiter, `DEL&#39; will move left over it; if
</span><span class='d'>;;; it is on an opening delimiter, `C-d&#39; will move right over it.  Only
</span><span class='d'>;;; if the point is between a pair of delimiters will `C-d&#39; or `DEL&#39;
</span><span class='d'>;;; delete them, and in that case it will delete both simultaneously.
</span><span class='d'>;;; `M-d&#39; and `M-DEL&#39; kill words, but skip over any S-expression
</span><span class='d'>;;; structure.  `C-k&#39; kills from the start of the line, either to the
</span><span class='d'>;;; line&#39;s end, if it contains only balanced expressions; to the first
</span><span class='d'>;;; closing delimiter, if the point is within a form that ends on the
</span><span class='d'>;;; line; or up to the end of the last expression that starts on the
</span><span class='d'>;;; line after the point.
</span><span class='d'>;;;
</span><span class='d'>;;; The behaviour of the commands for deleting and killing can be
</span><span class='d'>;;; overridden by passing a `C-u&#39; prefix argument: `C-u DEL&#39; will
</span><span class='d'>;;; delete a character backward, `C-u C-d&#39; will delete a character
</span><span class='d'>;;; forward, and `C-u C-k&#39; will kill text from the point to the end of
</span><span class='d'>;;; the line, irrespective of the S-expression structure in the buffer.
</span><span class='d'>;;; This can be used to fix mistakes in a buffer, but should generally
</span><span class='d'>;;; be avoided.
</span><span class='d'>;;;
</span><span class='d'>;;; Paredit performs automatic reindentation as locally as possible, to
</span><span class='d'>;;; avoid interfering with custom indentation used elsewhere in some
</span><span class='d'>;;; S-expression.  Only the advanced S-expression manipulation commands
</span><span class='d'>;;; automatically reindent, and only the forms that were immediately
</span><span class='d'>;;; operated upon (and their subforms).
</span><span class='d'>;;;
</span><span class='d'>;;; This code is written for clarity, not efficiency.  It frequently
</span><span class='d'>;;; walks over S-expressions redundantly.  If you have problems with
</span><span class='d'>;;; the time it takes to execute some of the commands, let me know, but
</span><span class='d'>;;; first be sure that what you&#39;re doing is reasonable: it is
</span><span class='d'>;;; preferable to avoid immense S-expressions in code anyway.
</span>
<span class='d'>;;; This assumes Unix-style LF line endings.
</span>
<span class='d'>(defconst paredit-version 22)</span>
(<a id='6833' tid='6834' class='u'>defconst</a> <a id='6835' tid='6836' class='u'>paredit-beta-p</a> <a id='6837' tid='6838' class='u'>nil</a>)

(<a id='6915' tid='6916' class='u'>eval-and-compile</a>

  (<a id='6897' tid='6898' class='u'>defun</a> <a id='6899' tid='6900' class='u'>paredit-xemacs-p</a> ()
    <a id='6901' tid='6902' class='u'>;; No idea where I got this definition from.  Edward O&#39;Connor
</a>    <a id='6903' tid='6904' class='u'>;; (hober in #emacs) suggested the current definition.
</a>    <a id='6905' tid='6906' class='u'>;;   (and (boundp &#39;running-xemacs)
</a>    <a id='6907' tid='6908' class='u'>;;        running-xemacs)
</a>    (<a id='6909' tid='6910' class='u'>featurep</a> <a id='6911' tid='6912' class='u'>&#39;</a><a id='6913' tid='6914' class='u'>xemacs</a>))

  (<a id='6839' tid='6840' class='u'>defun</a> <a id='6841' tid='6842' class='u'>paredit-gnu-emacs-p</a> ()
    <a id='6843' tid='6844' class='u'>;++ This could probably be improved.
</a>    (<a id='6845' tid='6846' class='u'>not</a> (<a id='6847' tid='6848' class='u'>paredit-xemacs-p</a>)))

  (<a id='6917' tid='6918' class='u'>defmacro</a> <a id='6919' tid='6920' class='u'>xcond</a> (<a id='6921' tid='6922' class='u'>&rest</a> <a id='6923' tid='6924' class='u'>clauses</a>)
    <a id='6925' tid='6926' class='u'>&quot;Exhaustive COND.
Signal an error if no clause matches.&quot;</a>
    <a id='6927' tid='6928' class='u'>`</a>(<a id='6929' tid='6930' class='u'>cond</a> <a id='6931' tid='6932' class='u'>,</a><a id='6933' tid='6934' class='u'>@clauses</a>
           (<a id='6935' tid='6936' class='u'>t</a> (<a id='6937' tid='6938' class='u'>error</a> <a id='6939' tid='6940' class='u'>&quot;XCOND lost.&quot;</a>))))

  (<a id='6941' tid='6942' class='u'>defalias</a> <a id='6943' tid='6944' class='u'>&#39;</a><a id='6945' tid='6946' class='u'>paredit-warn</a> (<a id='6947' tid='6948' class='u'>if</a> (<a id='6949' tid='6950' class='u'>fboundp</a> <a id='6951' tid='6952' class='u'>&#39;</a><a id='6953' tid='6954' class='u'